

from TTS.api import TTS
import re
import unicodedata
def clean_text(text):
    """深度清洗文本的复合函数"""
    # 第一阶段：换行符规范化
    text = re.sub(r'\r\n|\r|\u2028|\u2029', '\n', text)  # 统一换行符
    text = re.sub(r'(?<![。！？…])[\n]+(?![，。！？])', ' ', text)  # 移除句中换行
    text = re.sub(r'\n{3,}', '\n\n', text)  # 保留最多两个连续换行

    # 第二阶段：字符过滤与转换
    allowed_chars = r'[\u4e00-\u9fa5a-zA-Z0-9，。！？；：“”‘’【】、（）《》—\-\s]'
    text = re.sub(f'[^{allowed_chars}]', '', text)
    
    # 第三阶段：标点标准化
    punct_map = str.maketrans({'，': ',', '。': '.', '；': ';', '：': ':', '‘': "'", '’': "'", 
                              '“': '"', '”': '"', '！': '!', '？': '?', '（': '(', '）': ')'})
    text = text.translate(punct_map)
    
    # 第四阶段：全角字符转换
    text = unicodedata.normalize('NFKC', text)  # 同时处理全角数字/字母
    
    # 第五阶段：空白规范化
    text = re.sub(r'[ \t\u3000]+', ' ', text)  # 合并多种空白符
    text = re.sub(r'\n +', '\n', text)  # 移除行首空格
    return text.strip()

def process_text(text):
    # 替换所有换行符为句号（保留段落停顿）
    text = re.sub(r'[\r\n]+', '', text)
    # 清理其他非法字符
    text = re.sub(r'[^\u4e00-\u9fa5a-zA-Z0-9，。！？；：“”‘’—、（）《》\-\s]', '', text)
    return re.sub(r'\s+', ' ', text).strip()

# 原始文本（包含需要清洗的内容）
text = """
   告别了陈雄，我让黄毛解开锁链，让花臂取出艾莲娜骚屄和屁眼里的按摩棒，
和两个性奴坐上宾利，来到美乳大赛主办方提供的总统套房。明天，我们就要搬
到主办方提供的豪华宫殿里住上一个月，我有足够的时间好好玩弄这只新来的熟
肉母宠。

　　走进套房，我换了拖鞋，一屁股坐在做工考究的真皮沙发上，魏贞已经乖巧
地把自己身上的衣服脱光，露出一身雪白骚浪的贱肉，爬到我的脚边，正要用小
嘴叼着脱下我的臭袜子，冷不防被我的大手捉住了两只乳峰，拖到我的胯下。魏
贞善解人意地轻轻咬住我的裤子拉链，我的大鸡巴弹了出来，被魏贞熟练地含在
口中。我按住魏贞的头，把１８厘米的大鸡巴顶进魏贞的喉咙，魏贞呜咽一声，
认命地用喉头软肉包住我的鸡巴。我用一只大手抓住魏贞的秀发，享受着她的深
喉侍奉。

　　我让艾莲娜跪在我的面前，打量着她。太美了，实在太美了。艾莲娜长着一
头东方人特有的乌黑青丝，发尾却像西方人般微微自然卷曲。一张美丽绝伦的脸
蛋有着西方人的清晰轮廓，东方人精致柔和的五官，拉美的诱惑风情和越南人特
有的纯朴清新的野味。她的皮肤光泽而诱人，呈小麦色，身材的苗条继承了东方
人的特征，招牌性的肥乳巨臀却尽取西方人的精华。

　　尤其是那对饱满无比的Ｎ罩杯硕乳，和魏贞不相上下，乳峰顶端两粒奶头是
诱人的淡紫色，周围浮凸出一圈淡淡的乳晕，比魏贞熟褐色的奶头好看得多。魏
贞的奶头给人一种饱受摧残的感觉，配着沉甸甸的惊人肥乳，激发的是男人心中
暴虐的欲望，所以我经常把她的乳峰当烟灰缸，用烟头烫她的奶头。

　　我笑道：「你真让我惊讶到了，居然有和魏姐差不多大的奶子。说说看，怎
么长了这么对大奶子？」艾莲娜挺起大奶，恬不知耻地晃了晃，荡起一阵炫目的
乳浪，说：「我从小奶子就大，刚上中学就有Ｆ罩杯，１９岁的时候还上过《花
花公子》的封面。后来我嫁了一个有钱的老公，为他生了４个孩子，奶子涨到了
Ｊ罩杯。再后来，我遇到了第一个主人，给他生了５个孩子，奶子也涨到了现在
这么大。」我低头对着卖力干活的魏贞笑道：「魏姐，你听到没有，她生了９个
孩子才有了你这么大的奶子，你才生了３个。你要好好给我生儿子，让我看看你
的奶子能大到什么程度。」魏贞只好发出鼻音答应我。

　　我又问：「陈总看来很厉害，能把你调教得这么乖，他收了不少奴吧？」艾
莲娜妩媚一笑，说：「我的第一个主人，有１７个奴。我是他的第二个奴，我女
儿蜜雪儿是第三个。」我听得来了兴趣，说道：「哦，讲得详细点。」艾莲娜说：
「我女儿是被我第一个主人开苞的，那时他最宠爱我们母女俩。主人的第一个奴
是珍奴，她胆大包天，竟然逃走了，主人很生气，花了很大功夫才把她抓回来。
后来主人就没兴趣操她了，平常把她当做出大号的马桶，在她嘴里拉屎，拉好屎
让她用舌头舔干净，有时兴趣来了，就扩张她的骚穴和屁眼，把拳头伸进去玩。」
我笑道：「啧啧，真是严厉的主人。」艾莲娜继续说：「后来主人又收了芸奴。
主人最宠爱芸奴，不过芸奴的奶子可没我大，嘻嘻。两年前，主人带我们参加狩
猎大赛，芸奴被其他人猎走了，主人很失落，不过主人打到了１３个奴。里面主
人最喜欢的是梅奴。梅奴年纪很大了，已经４０岁了，但她做奴的时间长，最懂
伺候男人，皮肤雪白雪白的，奶子和屁股也大得离谱，都快赶上我了。梅奴的肚
子也争气，第一年就给主人生了个儿子。」
"""

# 执行文本清洗
cleaned_text = process_text(text)
a = cleaned_text.replace("，", "。")
print("清洗后文本:\n", a)

# 初始化TTS模型
tts = TTS(
    model_name="tts_models/zh-CN/baker/tacotron2-DDC-GST",
)

# 生成语音文件
tts.tts_to_file(
    text=a,     # 使用清洗后的文本
    file_path="output_1.wav",
    speaker_idx=2,
    max_decoder_steps=800,
    speed=1.1
)

print("语音文件已生成：output_1.wav")
